/* 2015-06-20 */ Object.prototype.equals=function(a){return this==a?!0:void 0},Array.prototype.contains=function(a){for(var b=0;b<this.length;b++){if(this[b]==a)return!0;if(a instanceof Object&&a.equals(this[b]))return!0}return!1};var app=angular.module("board",["ngRoute"]).controller("mainController",function(a,b,c,d,e){a.$route=b,a.$location=d,a.$routeParams=c}).config(function(a,b){a.when("/:subject",{}).when("/:subject/:articleId",{}),b.html5Mode({enabled:!0,requireBase:!1})});app.findScope=function(a){return angular.element(document.querySelector(a)).scope()},app.directive("article",function(){return{templateUrl:"/js/directive/article.html",restrict:"E",scope:{},controller:function(a,b,c,d){a["delete"]=function(){b("/api/post",{id:c.articleId},"DELETE").success(function(a){a&&app.findScope("[ng-controller='boardController']")["delete"](c.articleId)})},a.update=function(){a.updateState=!0},a.updateDone=function(){b("/api/post",a.article,"PUT").success(function(b){b&&(app.findScope("[ng-controller='boardController']").update(a.article),a.updateState=!1)})},a.hasRight=function(){return void 0==a.article?!1:d.email==a.article.writer},a.$watch(function(){return c.articleId},function(){b("/api/post",{id:c.articleId}).success(function(b){null!=b&&(a.article=b[0])})})}}}),Date.prototype.getString=function(){var a=this.getFullYear().toString(),b=(this.getMonth()+1).toString(),c=this.getDate().toString();return a+(b[1]?b:"0"+b[0])+(c[1]?c:"0"+c[0])},app.directive("newArticle",function(){return{templateUrl:"/js/directive/newArticle.html",restrict:"E",scope:{titles:"="},controller:function(a,b,c,d){a.user=d,a.article={},a.article.subject=c.subject,a.save=function(){b("/api/post",a.article,"POST").success(function(b){var c={};angular.copy(a.article,c),c.date=(new Date).getString(),c.writer=d.email,c.id=b,a.titles.push(c)})}}}}),app.directive("title",function(){return{templateUrl:"/js/directive/title.html",restrict:"A",scope:{title:"="},controller:function(a){}}}),app.factory("$req",function(a){var b=function(b,c,d){function e(a){var b=[];for(var c in a)"equals"!=c&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}void 0==d&&(d="GET"),void 0!=c&&(b+="?",b+=e(c));var f=a({method:d,url:b,headers:{"Content-Type":"application/x-www-form-urlencoded"}}),g=f.success;return f.success=function(a){g(function(b){a(b)})},f};return b}),app.service("$user",function(a){var b=this;a("/api/user").success(function(a){null!=a&&(b.logged=!0,b.email=a.email)})}),app.controller("boardController",function(a,b,c,d){function e(b){for(var c=0;c<a.titles.length;c++)if(a.titles[c].id==b)return c}d(function(){a.subject=c.subject,b("/api/post",{subject:c.subject}).success(function(b){return null==b?void(a.titles=[]):void(a.titles=b)})}),a["delete"]=function(b){var c=e(b);void 0!=c&&a.titles.splice(c,1)},a.update=function(b){var c=e(b.id);if(void 0!=c){var d=a.titles[c];d.title=b.title}}}),app.controller("loginController",function(a,b,c){a.user=c,a.login=function(){b("/api/user/login",c,"POST").success(function(a){return a?(alert("로그인 성공!"),void(c.logged=!0)):void alert("로그인 실패!")})},a.logout=function(){b("/api/user/logout").success(function(a){return a?(alert("로그아웃 성공!"),void(c.logged=!1)):void alert("로그아웃 실패!")})},a.register=function(){b("/api/user",c,"POST").success(function(a){return a?void alert("회원가입 성공!"):void alert("회원가입 실패!")})}});